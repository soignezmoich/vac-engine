<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.28.0">
    <meta name="project" content="Vac Engine v1.1.1">

    <title>VacEngine.Account â€” Vac Engine v1.1.1</title>
    <link rel="stylesheet" href="dist/elixir-a816d167216329cc463d.css" />

    <script src="dist/sidebar_items-5f79f8e75a.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/app-80aa23c1d96b6dc3c064.js"></script>


  </head>
  <body data-type="modules">
    <script>

      try {
        if (localStorage.getItem('night-mode') === 'true') {
          document.body.classList.add('night-mode');
        }
      } catch (error) { }
    </script>

<div class="main">


<section class="sidebar">
  <button class="sidebar-button sidebar-toggle">
    <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
  </button>

  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <i class="ri-search-2-line" aria-hidden="true" title="Submit search"></i>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <i class="ri-close-line ri-lg" aria-hidden="true" title="Cancel search"></i>
    </button>
    <label class="search-label">
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">

    <div class="sidebar-projectDetails">
      <a href="readme.html" class="sidebar-projectName" translate="no">
Vac Engine
      </a>
      <strong class="sidebar-projectVersion" translate="no">
        v1.1.1
      </strong>
    </div>
    <ul class="sidebar-listNav">
      <li><a id="extras-list-link" href="#full-list">GUIDES</a></li>

        <li><a id="modules-list-link" href="#full-list">Modules</a></li>


    </ul>
  </div>

  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>
<button class="settings display-settings">
  <i class="ri-settings-3-line"></i>
  <span class="sr-only">Settings</span>
</button>


    <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L1" title="View Source" class="view-source" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>

  <span translate="no">VacEngine.Account</span> 
  <small class="app-vsn" translate="no">(Vac Engine v1.1.1)</small>

</h1>


  <section id="moduledoc">
<p>Rsponsible for the management of a role-based permission system.</p><h2 id="module-roles" class="section-heading">
  <a href="#module-roles" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a>
  Roles
</h2>
<p>Primary entities to which permissions can be attached.
Identification to a specific role can be done by using either
a full authentication or through a token passed with the request.</p><p>Roles can be acquired by two access types: <strong>users</strong> and <strong>api-keys</strong>.</p><h3 id="module-users" class="section-heading">
  <a href="#module-users" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a>
  Users
</h3>
<p>User access allow people to access the web interface of the application.</p><p>A user can access the application by using a multi-factor authentication
with:</p><ul><li>an email login</li><li>a password</li><li>a one-time password provided by an authenticator</li></ul><p>User is attached to a single role, to which a set of permissions is granted.</p><h3 id="module-api-keys" class="section-heading">
  <a href="#module-api-keys" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a>
  Api-keys
</h3>
<p>Api-keys accesses are used by api consumers to call the application api.</p><p>A api-key can access the application by using a token that contain a password
and a reference to the role. If an existing token is provided with an api
request in the authentication header, the request is automatically associated
with the related role and permissions are granted accordingly.</p><p>Curl example of api call with key:</p><pre><code class="makeup elixir" translate="no"><span class="n">curl</span><span class="w"> </span><span class="n">https</span><span class="ss">://</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">p</span><span class="o">/</span><span class="mi">8</span><span class="o">/</span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="nc">X</span><span class="w"> </span><span class="nc">POST</span><span class="w">       </span><span class="o">-</span><span class="nc">H</span><span class="w"> </span><span class="s">&quot;Authorization: Bearer api_1234567_123456789012345678901234567890&quot;</span></code></pre><h2 id="module-permissions" class="section-heading">
  <a href="#module-permissions" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a>
  Permissions
</h2>
<h3 id="module-granting-permission" class="section-heading">
  <a href="#module-granting-permission" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a>
  Granting permission
</h3>
<p>Permissions are rights to do certain actions in the system. A permission is
granted to a role to perform a given in a given scope, by using the
<a href="#grant_permission/3"><code class="inline">grant_permission/3</code></a> (or <a href="#toggle_permission/3"><code class="inline">toggle_permission/3</code></a>) function:</p><pre><code class="makeup elixir" translate="no"><span class="nc">VacEngine.Account</span><span class="o">.</span><span class="n">grant_permission</span><span class="p" data-group-id="0812664465-1">(</span><span class="n">target_role</span><span class="p">,</span><span class="w"> </span><span class="ss">:list_blueprints_action</span><span class="p">,</span><span class="w"> </span><span class="ss">:global</span><span class="p" data-group-id="0812664465-1">)</span></code></pre><h3 id="module-checking-permission" class="section-heading">
  <a href="#module-checking-permission" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a>
  Checking permission
</h3>
<p>When a piece of code should only be accessed by roles with defined permission,
an conditional block containing the <a href="#can?/3"><code class="inline">can?/3</code></a> function should be added.</p><pre><code class="makeup elixir" translate="no"><span class="k">if</span><span class="w"> </span><span class="n">can?</span><span class="p" data-group-id="6943852399-1">(</span><span class="n">role</span><span class="p">,</span><span class="w"> </span><span class="ss">:access</span><span class="p">,</span><span class="w"> </span><span class="ss">:editor</span><span class="p" data-group-id="6943852399-1">)</span><span class="w"> </span><span class="k" data-group-id="6943852399-2">do</span><span class="w">
  </span><span class="n">...</span><span class="w">
</span><span class="k" data-group-id="6943852399-2">end</span></code></pre><p>The function will return true if and only if the current role has the
corresponding permission therefore granting access or not to the included
code.</p><h2 id="module-actions" class="section-heading">
  <a href="#module-actions" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a>
  Actions
</h2>
<p>Actions are atoms describing a specific action. The exact content
of the action is defined by the places where <a href="#can?/3"><code class="inline">can?/3</code></a> functions use it
as an argument.</p><h2 id="module-scopes" class="section-heading">
  <a href="#module-scopes" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a>
  Scopes
</h2>
<p>A scope determines a context in which a permission is granted. There is
three types of scope in the application, the <strong>global</strong> scope,
the <strong>worspace</strong> scopes and the <strong>custom</strong>.</p><h4>Global scope</h4><p>The global scope correspond to the whole application. Therefore permissions
granted in the global scope are technically &quot;unscoped&quot;.</p><p>Global scope is designated by the <code class="inline">:global</code> atom.</p><h4>Workspace scope</h4><p>A workspace scope is determined by the id of a workspace and grants the rights
in the context of this workspace. For example, an <code class="inline">:access</code> action permission
in the workspace with <code class="inline">:id = 1</code> will grant access only to this workspace.</p><p>Workspace scopes are designated a tuple containing the <code class="inline">:workspace</code> atom and
the id of the workspace, e.g.:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="6426220260-1">{</span><span class="ss">:workspace</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6426220260-1">}</span></code></pre><h4>Custom scope</h4><p>Other scopes can be created using a custom atom.</p><h2 id="module-schemas" class="section-heading">
  <a href="#module-schemas" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a>
  Schemas
</h2>
<p>Below, the list of the schemas described in the Account module.</p><h4>AccessToken</h4><p>Access tokens can be:</p><ul><li>API key</li><li>link token (not implemented yet)</li><li>oauth refresh token (not implemented yet)</li><li>oauth access token (not implemented yet)</li></ul><p>Secret format vary depending of the type</p><h4>BlueprintPermission</h4><p>A blueprint permission gives a permission on a blueprint to a role.</p><h4>GlobalPermission</h4><p>A global permission gives a site wide permission to a role.</p><h4>WorkspacePermission</h4><p>A workspace permissions give a workspace wide permission to a role.</p><h4>Role</h4><p>A role is the representation of an actor (user, api request...) to which
permissions can be attached.</p><h4>Session</h4><p>A session is created every time a user log in and bears the user's
permissions.</p><p>If the permissions change, the session must be recreated for the change
to take effect.</p><h4>User</h4><p>A user is a login method for a role of type &quot;user&quot;.</p><h4>Workspace</h4><p>The general container for blueprints and portals.</p><h2 id="module-security-design" class="section-heading">
  <a href="#module-security-design" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a>
  Security design
</h2>
<p>The Account module implements the following principe in order
to ensure security of the system:</p><ul><li>Users are authenticated using MFA (login/password + authentication).</li><li>Treatment of wrong login/password pairs are treated in constant time.</li><li>Sessions linked to role of all types (api-keys, users, tokens)
can be revocated by admin at any time.</li><li>Only admins have the right to publish a blueprint on a portal so that
no simple editor can influence the behaviour of the api.</li></ul>
  </section>


  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
      Summary
    </h1>

  <div class="summary-functions summary">
    <h2>
      <a href="#functions">Functions</a>
    </h2>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#activate_role/1" translate="no">activate_role(role)</a>

        </div>

          <div class="summary-synopsis"><p>Activate a role</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#bust_role_cache/1" translate="no">bust_role_cache(role)</a>

        </div>

          <div class="summary-synopsis"><p>Bust role cache</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#can?/3" translate="no">can?(role, action, scope \\ :global)</a>

        </div>

          <div class="summary-synopsis"><p>Check action against role with scope.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#change_role/2" translate="no">change_role(role, attrs \\ %{})</a>

        </div>

          <div class="summary-synopsis"><p>Cast attributes into a changeset</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#change_user/2" translate="no">change_user(data, attrs \\ %{})</a>

        </div>

          <div class="summary-synopsis"><p>Cast attributes into a changeset</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#change_workspace/2" translate="no">change_workspace(data, attrs \\ %{})</a>

        </div>

          <div class="summary-synopsis"><p>Cast attributes into a changeset</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#check_user/2" translate="no">check_user(email, password)</a>

        </div>

          <div class="summary-synopsis"><p>Check a email/password and return the user if both are valid (used for login)</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#create_api_token/2" translate="no">create_api_token(role, test \\ false)</a>

        </div>

          <div class="summary-synopsis"><p>Create an access token as API for a given role</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#create_permissions/2" translate="no">create_permissions(role, scope)</a>

        </div>

          <div class="summary-synopsis"><p>Create permissions for scope</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#create_role/2" translate="no">create_role(type, attrs \\ %{})</a>

        </div>

          <div class="summary-synopsis"><p>Create a role with attributes</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#create_session/2" translate="no">create_session(role, attrs)</a>

        </div>

          <div class="summary-synopsis"><p>Create a session with attributes</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#create_user/1" translate="no">create_user(attrs)</a>

        </div>

          <div class="summary-synopsis"><p>Create a user with attributes</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#create_workspace/1" translate="no">create_workspace(attrs)</a>

        </div>

          <div class="summary-synopsis"><p>Create a workspace with attributes</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#deactivate_role/1" translate="no">deactivate_role(role)</a>

        </div>

          <div class="summary-synopsis"><p>Desactivate a role.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#delete_permissions/2" translate="no">delete_permissions(role, scope)</a>

        </div>

          <div class="summary-synopsis"><p>Delete all permissions for scope</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#delete_role/1" translate="no">delete_role(role)</a>

        </div>

          <div class="summary-synopsis"><p>Delete role</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#delete_workspace/1" translate="no">delete_workspace(data)</a>

        </div>

          <div class="summary-synopsis"><p>Delete workspace.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#explode_composite_secret/1" translate="no">explode_composite_secret(secret)</a>

        </div>

          <div class="summary-synopsis"><p>Explode a secret.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#fetch_session/1" translate="no">fetch_session(token)</a>

        </div>

          <div class="summary-synopsis"><p>Try to find a session with given token</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#filter_accessible_workspaces/2" translate="no">filter_accessible_workspaces(query, role)</a>

        </div>

          <div class="summary-synopsis"><p>Filter available workspaces for a given role</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#filter_active_roles/1" translate="no">filter_active_roles(query)</a>

        </div>

          <div class="summary-synopsis"><p>Filter active role</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#filter_inactive_sessions/2" translate="no">filter_inactive_sessions(query, duration_sec)</a>

        </div>

          <div class="summary-synopsis"><p>Filter inactive since n seconds</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#filter_roles_by_type/2" translate="no">filter_roles_by_type(query, type)</a>

        </div>

          <div class="summary-synopsis"><p>Filter role by type</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#gen_totp/1" translate="no">gen_totp(user)</a>

        </div>

          <div class="summary-synopsis"><p>Generate a new TOTP url for the given user.
Return a <code class="inline">{url, secret}</code> tuple.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#generate_composite_secret/2" translate="no">generate_composite_secret(prefix, id)</a>

        </div>

          <div class="summary-synopsis"><p>Generate a secret with a prefix and id.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#generate_secret/1" translate="no">generate_secret(length \\ 16)</a>

        </div>

          <div class="summary-synopsis"><p>Generates a human friendly secret of <code class="inline">length</code> bytes long.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#get_role!/2" translate="no">get_role!(id, queries \\ &amp;(&amp;1))</a>

        </div>

          <div class="summary-synopsis"><p>Get a role with id, raise if not found.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#get_session!/1" translate="no">get_session!(id)</a>

        </div>

          <div class="summary-synopsis"><p>Get a session with id, raise if not found.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#get_user!/2" translate="no">get_user!(uid, queries \\ &amp;(&amp;1))</a>

        </div>

          <div class="summary-synopsis"><p>Get a user with id, raise if not found.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#get_workspace!/2" translate="no">get_workspace!(id, queries \\ &amp;(&amp;1))</a>

        </div>

          <div class="summary-synopsis"><p>Get a workspace with id, raise if not found.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#grant_permission/3" translate="no">grant_permission(role, action, scope \\ :global)</a>

        </div>

          <div class="summary-synopsis"><p>Grant permission with an action and scope</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#has?/3" translate="no">has?(role, action, scope \\ :global)</a>

        </div>

          <div class="summary-synopsis"><p>Check action against role with scope.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#has_permission?/3" translate="no">has_permission?(role, action, scope \\ :global)</a>

        </div>

          <div class="summary-synopsis"><p>Check permission directly without infer</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#list_api_keys/0" translate="no">list_api_keys()</a>

        </div>

          <div class="summary-synopsis"><p>List API keys with portal access for cached API access</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#list_api_tokens/1" translate="no">list_api_tokens(queries \\ &amp;(&amp;1))</a>

        </div>

          <div class="summary-synopsis"><p>Return all API tokens</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#list_roles/1" translate="no">list_roles(queries \\ &amp;(&amp;1))</a>

        </div>

          <div class="summary-synopsis"><p>List roles</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#list_sessions/1" translate="no">list_sessions(queries \\ &amp;(&amp;1))</a>

        </div>

          <div class="summary-synopsis"><p>List sessions</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#list_users/1" translate="no">list_users(queries \\ &amp;(&amp;1))</a>

        </div>

          <div class="summary-synopsis"><p>Return all users with <code class="inline">last_login_at</code> and <code class="inline">last_active_at</code> virtual fields
populated</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#list_workspaces/1" translate="no">list_workspaces(queries \\ &amp;(&amp;1))</a>

        </div>

          <div class="summary-synopsis"><p>List all workspaces</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#load_api_tokens/1" translate="no">load_api_tokens(query)</a>

        </div>

          <div class="summary-synopsis"><p>Load te <code class="inline">api_tokens</code> assoc of a given role</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#load_role_permission_scopes/1" translate="no">load_role_permission_scopes(query)</a>

        </div>

          <div class="summary-synopsis"><p>Load all permission assoc with scope (workspace, portal, blueprint)</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#load_role_permissions/1" translate="no">load_role_permissions(query)</a>

        </div>

          <div class="summary-synopsis"><p>Load all permission assoc</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#load_role_sessions/1" translate="no">load_role_sessions(query)</a>

        </div>

          <div class="summary-synopsis"><p>Load session assoc</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#load_user_activity/1" translate="no">load_user_activity(query)</a>

        </div>

          <div class="summary-synopsis"><p>Preload user activity</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#load_user_role/1" translate="no">load_user_role(query)</a>

        </div>

          <div class="summary-synopsis"><p>Load role assoc</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#load_workspace_blueprints/1" translate="no">load_workspace_blueprints(query)</a>

        </div>

          <div class="summary-synopsis"><p>Load blueprints assoc</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#load_workspace_stats/1" translate="no">load_workspace_stats(query)</a>

        </div>

          <div class="summary-synopsis"><p>Load blueprint_count and active_publication_count</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#revoke_permission/3" translate="no">revoke_permission(role, action, scope \\ :global)</a>

        </div>

          <div class="summary-synopsis"><p>Revoke permission with an action and scope</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#revoke_session/1" translate="no">revoke_session(session)</a>

        </div>

          <div class="summary-synopsis"><p>Revoke session</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#toggle_permission/3" translate="no">toggle_permission(role, action, scope \\ :global)</a>

        </div>

          <div class="summary-synopsis"><p>Toggle permission with an action and scope</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#touch_session/1" translate="no">touch_session(session)</a>

        </div>

          <div class="summary-synopsis"><p>Set session last activity time to now</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#update_role/2" translate="no">update_role(role, attrs \\ %{})</a>

        </div>

          <div class="summary-synopsis"><p>Update role with attributes</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#update_session/2" translate="no">update_session(session, attrs)</a>

        </div>

          <div class="summary-synopsis"><p>Update session with attributes</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#update_user/2" translate="no">update_user(data, attrs)</a>

        </div>

          <div class="summary-synopsis"><p>Update user with attributes. This will cast all user attributes and should
only be called from an admin context.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#update_workspace/2" translate="no">update_workspace(data, attrs)</a>

        </div>

          <div class="summary-synopsis"><p>Update workspace with attributes</p></div>

      </div>

  </div>

  </section>


  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
Functions
    </h1>
    <div class="functions-list">
<section class="detail" id="activate_role/1">

  <div class="detail-header">
    <a href="#activate_role/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">activate_role(role)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L409" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Activate a role</p>
  </section>
</section>
<section class="detail" id="bust_role_cache/1">

  <div class="detail-header">
    <a href="#bust_role_cache/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">bust_role_cache(role)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L414" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Bust role cache</p>
  </section>
</section>
<section class="detail" id="can?/3">

    <span id="can?/2"></span>

  <div class="detail-header">
    <a href="#can?/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">can?(role, action, scope \\ :global)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L193" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Check action against role with scope.</p>
  </section>
</section>
<section class="detail" id="change_role/2">

    <span id="change_role/1"></span>

  <div class="detail-header">
    <a href="#change_role/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">change_role(role, attrs \\ %{})</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L399" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Cast attributes into a changeset</p>
  </section>
</section>
<section class="detail" id="change_user/2">

    <span id="change_user/1"></span>

  <div class="detail-header">
    <a href="#change_user/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">change_user(data, attrs \\ %{})</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L293" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Cast attributes into a changeset</p>
  </section>
</section>
<section class="detail" id="change_workspace/2">

    <span id="change_workspace/1"></span>

  <div class="detail-header">
    <a href="#change_workspace/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">change_workspace(data, attrs \\ %{})</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L235" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Cast attributes into a changeset</p>
  </section>
</section>
<section class="detail" id="check_user/2">

  <div class="detail-header">
    <a href="#check_user/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">check_user(email, password)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L281" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Check a email/password and return the user if both are valid (used for login)</p><p>If the password is nil or wrong or the user not found, the time for the check
will be constant.</p>
  </section>
</section>
<section class="detail" id="create_api_token/2">

    <span id="create_api_token/1"></span>

  <div class="detail-header">
    <a href="#create_api_token/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">create_api_token(role, test \\ false)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L450" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Create an access token as API for a given role</p>
  </section>
</section>
<section class="detail" id="create_permissions/2">

  <div class="detail-header">
    <a href="#create_permissions/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">create_permissions(role, scope)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L181" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Create permissions for scope</p>
  </section>
</section>
<section class="detail" id="create_role/2">

    <span id="create_role/1"></span>

  <div class="detail-header">
    <a href="#create_role/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">create_role(type, attrs \\ %{})</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L389" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Create a role with attributes</p>
  </section>
</section>
<section class="detail" id="create_session/2">

  <div class="detail-header">
    <a href="#create_session/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">create_session(role, attrs)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L337" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Create a session with attributes</p>
  </section>
</section>
<section class="detail" id="create_user/1">

  <div class="detail-header">
    <a href="#create_user/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">create_user(attrs)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L288" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Create a user with attributes</p><p>This will also create the &quot;role&quot; for the user and set it as active</p>
  </section>
</section>
<section class="detail" id="create_workspace/1">

  <div class="detail-header">
    <a href="#create_workspace/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">create_workspace(attrs)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L230" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Create a workspace with attributes</p>
  </section>
</section>
<section class="detail" id="deactivate_role/1">

  <div class="detail-header">
    <a href="#deactivate_role/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">deactivate_role(role)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L424" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Desactivate a role.</p><p>Will revoke all sessions.</p><p>This will NOT disconnect live views, this is the responsibility of the
web layer.</p>
  </section>
</section>
<section class="detail" id="delete_permissions/2">

  <div class="detail-header">
    <a href="#delete_permissions/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">delete_permissions(role, scope)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L186" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Delete all permissions for scope</p>
  </section>
</section>
<section class="detail" id="delete_role/1">

  <div class="detail-header">
    <a href="#delete_role/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">delete_role(role)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L404" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Delete role</p>
  </section>
</section>
<section class="detail" id="delete_workspace/1">

  <div class="detail-header">
    <a href="#delete_workspace/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">delete_workspace(data)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L247" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Delete workspace.</p><p>This will fail is the workspace has any blueprint or portal</p>
  </section>
</section>
<section class="detail" id="explode_composite_secret/1">

  <div class="detail-header">
    <a href="#explode_composite_secret/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">explode_composite_secret(secret)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L463" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Explode a secret.</p><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="n">sec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generate_composite_secret</span><span class="p" data-group-id="6067780870-1">(</span><span class="ss">:role</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p" data-group-id="6067780870-1">)</span><span class="w">
</span><span class="gp unselectable">...&gt; </span><span class="p" data-group-id="6067780870-2">%{</span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span><span class="w"> </span><span class="ss">prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;role&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">secret</span><span class="p">:</span><span class="w"> </span><span class="bp">_</span><span class="p" data-group-id="6067780870-2">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explode_composite_secret</span><span class="p" data-group-id="6067780870-3">(</span><span class="n">sec</span><span class="p" data-group-id="6067780870-3">)</span></code></pre>
  </section>
</section>
<section class="detail" id="fetch_session/1">

  <div class="detail-header">
    <a href="#fetch_session/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">fetch_session(token)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L312" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Try to find a session with given token</p>
  </section>
</section>
<section class="detail" id="filter_accessible_workspaces/2">

  <div class="detail-header">
    <a href="#filter_accessible_workspaces/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">filter_accessible_workspaces(query, role)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L215" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Filter available workspaces for a given role</p>
  </section>
</section>
<section class="detail" id="filter_active_roles/1">

  <div class="detail-header">
    <a href="#filter_active_roles/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">filter_active_roles(query)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L369" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Filter active role</p>
  </section>
</section>
<section class="detail" id="filter_inactive_sessions/2">

  <div class="detail-header">
    <a href="#filter_inactive_sessions/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">filter_inactive_sessions(query, duration_sec)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L332" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Filter inactive since n seconds</p>
  </section>
</section>
<section class="detail" id="filter_roles_by_type/2">

  <div class="detail-header">
    <a href="#filter_roles_by_type/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">filter_roles_by_type(query, type)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L364" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Filter role by type</p>
  </section>
</section>
<section class="detail" id="gen_totp/1">

  <div class="detail-header">
    <a href="#gen_totp/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">gen_totp(user)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L305" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Generate a new TOTP url for the given user.
Return a <code class="inline">{url, secret}</code> tuple.</p>
  </section>
</section>
<section class="detail" id="generate_composite_secret/2">

  <div class="detail-header">
    <a href="#generate_composite_secret/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">generate_composite_secret(prefix, id)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L455" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Generate a secret with a prefix and id.</p>
  </section>
</section>
<section class="detail" id="generate_secret/1">

    <span id="generate_secret/0"></span>

  <div class="detail-header">
    <a href="#generate_secret/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">generate_secret(length \\ 16)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L445" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Generates a human friendly secret of <code class="inline">length</code> bytes long.</p><p>Length must be multiple of 4.</p><p>Crypto secure.</p>
  </section>
</section>
<section class="detail" id="get_role!/2">

    <span id="get_role!/1"></span>

  <div class="detail-header">
    <a href="#get_role!/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_role!(id, queries \\ &amp;(&amp;1))</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L359" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Get a role with id, raise if not found.</p>
  </section>
</section>
<section class="detail" id="get_session!/1">

  <div class="detail-header">
    <a href="#get_session!/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_session!(id)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L327" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Get a session with id, raise if not found.</p>
  </section>
</section>
<section class="detail" id="get_user!/2">

    <span id="get_user!/1"></span>

  <div class="detail-header">
    <a href="#get_user!/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_user!(uid, queries \\ &amp;(&amp;1))</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L260" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Get a user with id, raise if not found.</p>
  </section>
</section>
<section class="detail" id="get_workspace!/2">

    <span id="get_workspace!/1"></span>

  <div class="detail-header">
    <a href="#get_workspace!/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_workspace!(id, queries \\ &amp;(&amp;1))</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L210" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Get a workspace with id, raise if not found.</p>
  </section>
</section>
<section class="detail" id="grant_permission/3">

    <span id="grant_permission/2"></span>

  <div class="detail-header">
    <a href="#grant_permission/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">grant_permission(role, action, scope \\ :global)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L163" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Grant permission with an action and scope</p>
  </section>
</section>
<section class="detail" id="has?/3">

    <span id="has?/2"></span>

  <div class="detail-header">
    <a href="#has?/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">has?(role, action, scope \\ :global)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L198" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Check action against role with scope.</p>
  </section>
</section>
<section class="detail" id="has_permission?/3">

    <span id="has_permission?/2"></span>

  <div class="detail-header">
    <a href="#has_permission?/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">has_permission?(role, action, scope \\ :global)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L175" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Check permission directly without infer</p>
  </section>
</section>
<section class="detail" id="list_api_keys/0">

  <div class="detail-header">
    <a href="#list_api_keys/0" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">list_api_keys()</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L468" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>List API keys with portal access for cached API access</p>
  </section>
</section>
<section class="detail" id="list_api_tokens/1">

    <span id="list_api_tokens/0"></span>

  <div class="detail-header">
    <a href="#list_api_tokens/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">list_api_tokens(queries \\ &amp;(&amp;1))</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L431" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Return all API tokens</p>
  </section>
</section>
<section class="detail" id="list_roles/1">

    <span id="list_roles/0"></span>

  <div class="detail-header">
    <a href="#list_roles/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">list_roles(queries \\ &amp;(&amp;1))</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L354" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>List roles</p>
  </section>
</section>
<section class="detail" id="list_sessions/1">

    <span id="list_sessions/0"></span>

  <div class="detail-header">
    <a href="#list_sessions/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">list_sessions(queries \\ &amp;(&amp;1))</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L322" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>List sessions</p>
  </section>
</section>
<section class="detail" id="list_users/1">

    <span id="list_users/0"></span>

  <div class="detail-header">
    <a href="#list_users/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">list_users(queries \\ &amp;(&amp;1))</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L255" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Return all users with <code class="inline">last_login_at</code> and <code class="inline">last_active_at</code> virtual fields
populated</p>
  </section>
</section>
<section class="detail" id="list_workspaces/1">

    <span id="list_workspaces/0"></span>

  <div class="detail-header">
    <a href="#list_workspaces/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">list_workspaces(queries \\ &amp;(&amp;1))</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L205" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>List all workspaces</p>
  </section>
</section>
<section class="detail" id="load_api_tokens/1">

  <div class="detail-header">
    <a href="#load_api_tokens/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">load_api_tokens(query)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L436" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Load te <code class="inline">api_tokens</code> assoc of a given role</p>
  </section>
</section>
<section class="detail" id="load_role_permission_scopes/1">

  <div class="detail-header">
    <a href="#load_role_permission_scopes/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">load_role_permission_scopes(query)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L384" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Load all permission assoc with scope (workspace, portal, blueprint)</p>
  </section>
</section>
<section class="detail" id="load_role_permissions/1">

  <div class="detail-header">
    <a href="#load_role_permissions/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">load_role_permissions(query)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L379" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Load all permission assoc</p>
  </section>
</section>
<section class="detail" id="load_role_sessions/1">

  <div class="detail-header">
    <a href="#load_role_sessions/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">load_role_sessions(query)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L374" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Load session assoc</p>
  </section>
</section>
<section class="detail" id="load_user_activity/1">

  <div class="detail-header">
    <a href="#load_user_activity/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">load_user_activity(query)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L268" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Preload user activity</p><p>Will load role, all sessions and populate <code class="inline">is_active</code>, <code class="inline">last_login_at</code> and
<code class="inline">last_active_at</code> virtual fields.</p>
  </section>
</section>
<section class="detail" id="load_user_role/1">

  <div class="detail-header">
    <a href="#load_user_role/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">load_user_role(query)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L273" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Load role assoc</p>
  </section>
</section>
<section class="detail" id="load_workspace_blueprints/1">

  <div class="detail-header">
    <a href="#load_workspace_blueprints/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">load_workspace_blueprints(query)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L220" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Load blueprints assoc</p>
  </section>
</section>
<section class="detail" id="load_workspace_stats/1">

  <div class="detail-header">
    <a href="#load_workspace_stats/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">load_workspace_stats(query)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L225" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Load blueprint_count and active_publication_count</p>
  </section>
</section>
<section class="detail" id="revoke_permission/3">

    <span id="revoke_permission/2"></span>

  <div class="detail-header">
    <a href="#revoke_permission/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">revoke_permission(role, action, scope \\ :global)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L169" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Revoke permission with an action and scope</p>
  </section>
</section>
<section class="detail" id="revoke_session/1">

  <div class="detail-header">
    <a href="#revoke_session/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">revoke_session(session)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L347" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Revoke session</p>
  </section>
</section>
<section class="detail" id="toggle_permission/3">

    <span id="toggle_permission/2"></span>

  <div class="detail-header">
    <a href="#toggle_permission/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">toggle_permission(role, action, scope \\ :global)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L157" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Toggle permission with an action and scope</p>
  </section>
</section>
<section class="detail" id="touch_session/1">

  <div class="detail-header">
    <a href="#touch_session/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">touch_session(session)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L317" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Set session last activity time to now</p>
  </section>
</section>
<section class="detail" id="update_role/2">

    <span id="update_role/1"></span>

  <div class="detail-header">
    <a href="#update_role/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">update_role(role, attrs \\ %{})</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L394" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Update role with attributes</p>
  </section>
</section>
<section class="detail" id="update_session/2">

  <div class="detail-header">
    <a href="#update_session/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">update_session(session, attrs)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L342" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Update session with attributes</p>
  </section>
</section>
<section class="detail" id="update_user/2">

  <div class="detail-header">
    <a href="#update_user/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">update_user(data, attrs)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L299" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Update user with attributes. This will cast all user attributes and should
only be called from an admin context.</p>
  </section>
</section>
<section class="detail" id="update_workspace/2">

  <div class="detail-header">
    <a href="#update_workspace/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">update_workspace(data, attrs)</h1>

      <a href="https://github.com/soignezmoich/vac-engine/blob/main/lib/vac_engine/account.ex#L240" class="view-source" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Update workspace with attributes</p>
  </section>
</section>

    </div>
  </section>

      <footer class="footer">

          <p>
            On Hex.pm:

            <span class="line">
              <a href="https://hex.pm/packages/vac_engine/1.1.1" class="line footer-hex-package">Package</a>
              <a href="https://preview.hex.pm/preview/vac_engine/1.1.1" class="line">Preview</a>

                <a href="https://preview.hex.pm/preview/vac_engine/1.1.1/show/lib/vac_engine/account.ex">(current file)</a>

            </span>

            <button class="line footer-button display-quick-switch">
              Search
            </button>
          </p>

        <p>
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.28.0) for the
          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>
        </p>
      </footer>
    </div>
  </div>
</section>
</div>


  </body>
</html>
